<?php

/**
 * @file
 * Test bibdk favourite implementation.
 */
// test deletion of profile type
/**
 * Check that basic user login functionality works.
 */
class bibdkFavouriteTest extends DrupalWebTestCase {

  public function setUp() {
    module_enable(array('openagency_webservice_mockup'));
    parent::setUp(array('ding_user', 'bibdk_test_provider', 'ting_agency', 'openagency_webservice_mockup'));
    //$this->standard_user = $this->drupalCreateUser();
  }

  /**
   * Info for this test case
   */
  public function getInfo() {
    return array(
      'name' => 'Bibdk favourite',
      'description' => t('Test create/delete of bibdk_favourite_list profile2 type'),
      'group' => 'Bibliotek.dk - Favourites',
    );
  }

// check if profiletype is created after module has been enabled
// and user logs in.
  function testCheckProfileType() {
    //first disable module
    module_disable(array('bibdk_favourite'));
    $edit['name'] = 'testuser';
    $edit['pass'] = 'password';
    // we have to submit the user_login_block form to log in as provider user
    $this->drupalPost('user/login', $edit, t('Log in'), array(), array(), 'user-login', NULL);
    $this->drupalGet('user/2');
    $this->assertNoLink('Favourites');
    // enable module
    module_enable(array('bibdk_favourite'));
    menu_rebuild();

    global $base_url;
    variable_set('agency_search_url', $base_url . '/openagency_webservice/');
    //variable_set('agency_search_url', 'http://openagency.addi.dk/2.8/');
    $this->drupalGet('user/2');
    $this->assertLink('Favourites');
    $this->clickLink('Favourites');
    // assert that profile tab is shown
    $this->assertLink('set_as_favourite');
    $this->assertLink('Find library');
    $this->assertText('Copenhagen Townhall', 'profile tab is set');
  }
}
